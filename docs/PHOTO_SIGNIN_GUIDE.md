# 拍照签到功能使用指南

## 功能概述

拍照签到功能支持两种方式进行人脸识别签到：
1. **摄像头实时拍照** - 使用设备摄像头拍照后识别签到
2. **上传图片** - 上传已有图片进行批量识别签到

## 使用方式

### 方式一：摄像头拍照签到

1. 进入 **拍照签到** 页面
2. 点击 "开启摄像头" 按钮
3. 将人脸对准摄像头
4. 点击 "拍照" 按钮捕获画面
5. 确认照片后点击 "确认识别签到"
6. 系统自动识别并签到

**优点：**
- 实时反馈
- 单人快速签到
- 适合考勤机场景

### 方式二：上传图片签到

1. 进入 **拍照签到** 页面
2. 切换到 "上传图片" 标签
3. 拖拽或点击上传课堂照片
4. 预览图片
5. 点击 "开始识别签到"
6. 系统批量识别并签到

**优点：**
- 批量识别多人
- 支持课堂照片
- 可离线拍照后上传

## 识别结果说明

识别完成后会显示详细结果：

### 签到成功 ✅
- 显示已签到的学生列表
- 包含姓名、置信度、签到时间

### 识别成功（未签到）⚠️
可能原因：
- 今日已签到（重复签到）
- 学生信息未在数据库中

### 未识别 ❌
可能原因：
- 人脸未注册
- 照片质量差（模糊、侧脸、遮挡）
- 光线不佳

## 注意事项

### 照片要求
- ✅ 清晰的正面照片
- ✅ 光线充足
- ✅ 人脸占比合适（不要太远或太近）
- ❌ 避免严重遮挡（口罩、墨镜）
- ❌ 避免侧脸或低头

### 识别阈值
- 当前阈值：**0.45**（在 `src/config.py` 中配置）
- 置信度 >= 70%：识别准确度高
- 置信度 50-70%：可能存在误差
- 置信度 < 50%：不进行匹配

### 性能提示
- 首次调用识别接口可能需要加载模型（约5-10秒）
- 后续识别速度较快（1-3秒）
- 单张图片支持识别多人

## 快捷入口

除了拍照签到页面，还可以从以下位置快速进入：
- **实时监控** 页面 → 快捷操作 → "拍照签到" 按钮
- 侧边栏菜单 → "拍照签到"

## API 接口

### 上传图片识别签到
```
POST /api/recognition/upload-image
Content-Type: multipart/form-data 或 application/json

方式1 - 文件上传:
{
  "file": <图片文件>
}

方式2 - Base64:
{
  "image": "data:image/jpeg;base64,..."
}

响应:
{
  "success": true,
  "message": "检测到 3 个人脸，识别成功 3 人，签到成功 2 人",
  "data": {
    "detected_faces": 3,
    "recognized": [...],
    "unknown": [...],
    "signed_in": [...]
  }
}
```

### 仅识别（不签到）
```
POST /api/recognition/recognize-only

用于预览识别结果，不会记录签到
```

## 故障排除

### 问题：摄像头无法开启
**解决方案：**
1. 检查浏览器权限设置
2. 确保使用 HTTPS 或 localhost
3. 检查摄像头是否被其他程序占用

### 问题：识别不准确
**解决方案：**
1. 确保人脸照片库已注册
2. 调整 `config.py` 中的 `MATCH_THRESHOLD`
3. 使用更清晰的照片

### 问题：识别速度慢
**解决方案：**
1. 首次调用需要加载模型，请耐心等待
2. 减小上传图片的分辨率
3. 确保服务器性能充足

## 相关文件

- 后端API：`src/api/recognition.py`
- 前端页面：`frontend/src/views/PhotoSignin.vue`
- 配置文件：`src/config.py`
- 识别核心：`src/inference.py`
